<!-- Memanggil base template -->
{% extends 'layout/base.html' %}

<!-- Judul Halaman -->
{% block title %}List Of Project{% endblock %}

<!-- Konten Halaman -->
{% block content %}
<!-- Modifikasi di sini -->
<div class="col-lg-12">
  <div class="card">
    <div class="container mt-4">
      <h4 class="text-primary">Daftar Proyek</h4>
      <table id="proyekTable" class="table table-striped">
        <thead>
          <tr>
            <th>Nama Proyek</th>
            <th>Deskripsi</th>
            <th>Periode Mulai</th>
            <th>Periode Selesai</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
<script>
  $(document).ready(function () {
    $("#proyekTable").DataTable({
      ajax: {
        url: "/api/proyek",
        dataSrc: "",
      },
      columns: [
        { data: "nama_proyek" },
        { data: "deskripsi" },
        { data: "periode_mulai" },
        { data: "periode_selesai" },
        {
          data: null, // Kolom untuk tombol
          orderable: false, // Nonaktifkan pengurutan untuk kolom ini
          render: function (data, type, row) {
            return `
                        <button class="btn btn-primary btn-sm view-btn" data-id="${row.id}">
                            View
                        </button>
                        <button class="btn btn-success btn-sm participate-btn" data-id="${row.id}">
                            Participate
                        </button>
                    `;
          },
        },
      ],
    });
    // Event listener untuk tombol View
    $("#proyekTable").on("click", ".view-btn", function () {
      const id = $(this).data("id");
      // Contoh: Navigasi ke halaman detail proyek
      window.location.href = `/proyek/${id}/view`;
    });

    // Event listener untuk tombol Participate
    $("#proyekTable").on("click", ".participate-btn", function () {
      const id = $(this).data("id");
      // Contoh: Aksi partisipasi, bisa AJAX atau navigasi
      if (confirm("Are you sure to participate in this project?")) {
        window.location.href = `/proyek/${id}/participate`;
        // $.get(`/proyek/${id}/participate`, function (response) {
        //     alert(response.message || "Participation successful!");
        //     // table.ajax.reload(); // Reload data table
        //     window.location.href = `/proyek/${id}/participate`;
        // }).fail(function () {
        //     alert("Failed to participate. Please try again.");
        // });
      }
    });
  });
</script>
<!-- ------------------ -->
{% endblock %}
